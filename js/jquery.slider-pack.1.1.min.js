/*
 * Two Dimensional Slider for Touchfolio theme.
 *
 * Copyright 2012 Dmitry Semenov. http://dimsemenov.com
 *
 * You must not use this slider outside the Touchfolio theme. Slider is based on commercial RoyalSlider script.
 *
*/
(function(e){function t(t,n){var r=navigator.userAgent.toLowerCase(),s=this,o=jQuery.browser,u=o.mozilla,a,f=o.webkit,l=r.match(/(iphone|ipod|ipad)/),c=r.indexOf("android")>-1,h=r.indexOf("chrome")>-1,p=navigator.appVersion.indexOf("Mac")!=-1;var d=document.createElement("div").style,v=["webkit","Moz","ms","O"],m="",g;for(i=0;i<v.length;i++){g=v[i];if(!m&&g+"Transform"in d){m=g}g=g.toLowerCase()}s._isChrome=h;s._wpVars=tdSliderVars;s.sliderRoot=e(t);s._slidesWrapper=s.sliderRoot.find(".slider-wrapper");s._loopItems=false;s._loopAlbums=false;s.onTransitionStart=function(){};s.onTransitionComplete=function(){};s._startTime;s._moveDist;s._accelerationX;s._accelerationY;s._currAnimSpeed;s._isVerticalNav=false;s._currMoveAxis="none";s._collapsedSlider=false;s._isAnimating=false;s._isDragging=false;s._multipleTouches=false;s.moved;s.startX;s.startY;s.pointX;s.pointY;s.changedX;s.changedY;s.firstLoaded=false;s.directionLocked;s.x=0;s.y=0;s.loadingTimeout;s.settings=e.extend({},e.fn.twoDimSlider.defaults,n);s._useCSS3Transitions=s._use3dTransform=!h?Modernizr.csstransforms3d:false;s._orientationChangeEvent="onorientationchange"in window?"orientationchange.tds resize.tds":"resize.tds";if(window.navigator.msPointerEnabled){if("ontouchstart"in window||"createTouch"in document){s.hasTouch=false}s._downEvent="MSPointerDown.tds";s._moveEvent="MSPointerMove.tds";s._upEvent="MSPointerUp.tds ";s._cancelEvent=s._upEvent;s._clickEvent=s._downEvent}else if("ontouchstart"in window||"createTouch"in document){s.hasTouch=true;s._downEvent="touchstart.tds";s._moveEvent="touchmove.tds";s._upEvent="touchend.tds ";s._cancelEvent="touchcancel.tds";s._clickEvent="touchstart"}else{s.hasTouch=false;s._grabCursor;s._grabbingCursor;var r=e.browser;if(r.msie||r.opera){s._grabCursor=s._grabbingCursor="move"}else if(r.mozilla){s._grabCursor="-moz-grab";s._grabbingCursor="-moz-grabbing"}else if(p&&f){s._grabCursor="-webkit-grab";s._grabbingCursor="-webkit-grabbing"}else{}this._setGrabCursor();s._downEvent="mousedown.tds";s._moveEvent="mousemove.tds";s._upEvent="mouseup.tds";s._cancelEvent="mouseup.tds";s._clickEvent="click"}if(!s.hasTouch){s._arrowControlsEnabled=true;s._fastClick="click"}else{s._arrowControlsEnabled=true;s._fastClick="touchstart"}var y='<div class="slider-wrapper"><div class="drag-container">',b=["center","top","right","bottom","left"];e.each(b,function(){y+='<div class="block '+this+'"><div class="block-inside"></div></div>'});y+="</div></div>";y+='<div class="video-overlay"><div class=" video-close-button"><a href="javascript:void();" class="hidden-video underlined">'+s._wpVars.closeVideo+'</a></div><div class="video-container"></div></div>';if(s._arrowControlsEnabled){}y+='<div class="slider-controls">';if(s._arrowControlsEnabled){y+='<div class="arrow-left disabled-arrow"><a  href="javascript:void(0);" class="icon-bg"><span class="icon"></span><span class="info-text">'+s._wpVars.prevAlbum+"</span></a></div>"+'<div class="arrow-right"><a href="javascript:void(0);" class="icon-bg"><span class="icon"></span><span class="info-text">'+s._wpVars.nextAlbum+"</span></a></div>"}var w=s._getQueryParameters().listurl;if(w){y+='<div class="back-to-list-button"><a class="close-gallery-button underlined" href="'+w+'">'+s._wpVars.backToList+"</a></div>"}y+='<div class="slider-album-indicator">';y+='<div class="album-info-text">'+'<a href="javascript:void(0);" title="Info" class="album-name-indicator underlined"></a>'+'<span class="item-count-indicator"></span>'+"</div>";y+="</div>";y+="</div>";s._galleryPostsNavigation=s.sliderRoot.find(".gallery-posts-navigation");s._lastItemLink=false;if(s._galleryPostsNavigation.length>0){s._lastItemLink=true}s.sliderRoot.append(y);s._slidesWrapper=s.sliderRoot.find(".slider-wrapper");s.videoOverlay=s.sliderRoot.find(".video-overlay");s.videoContainer=s.videoOverlay.find(".video-container");s.currVideoImg="";s.isVideoPlaying=false;s._videoCloseButton=s.videoOverlay.find(".video-close-button");s._videoCloseButton.bind("click",function(e){s.stopAndCloseVideo()});s._nextPrevActionsLocked=false;var E=s._slidesWrapper;s._dragContainer=E.find(".drag-container");s._topBlock=E.find(".top");s._leftBlock=E.find(".left");s._centerBlock=E.find(".center");s._rightBlock=E.find(".right");s._bottomBlock=E.find(".bottom");s._albumInfoAnimating=false;s.loadQueue;s.imageLoader;s._lastAlbumId;s._lastAlbumNumItems;s._lastItemId;s._changeHash=false;s._imagePaddingEMs=0;s._controlsVisible=true;s._currentMainBlockId=0;s._currentMainAlbumBlockId=0;s._tempMainBlockId=0;s._tempMainAlbumBlockId=0;if(s.settings.disableContextMenu){s.sliderRoot.bind("contextmenu",function(e){e.preventDefault();e.stopImmediatePropagation();return false})}if(s.hasTouch){s._lastItemFriction=.5;s.settings.autoOpenDescription=false}else{s._lastItemFriction=.2}if(s._useCSS3Transitions){if(u&&m==="moz"){s.browserSufix="-moz-";s._yProp=s._xProp="-moz-transform";s.transitionEndEvent="transitionend.tds";if(s._use3dTransform){s._tPref1="translate3d(";s._tPref2="px, ";s._tPref3="px, 0px)"}else{s._tPref1="translate(";s._tPref2="px, ";s._tPref3="px)"}}else if(f&&s._use3dTransform){s.browserSufix="-webkit-";s._yProp=s._xProp="-webkit-transform";s.transitionEndEvent="webkitTransitionEnd.tds";if(s._use3dTransform){if(!h){s._dragContainer.children().css({"-webkit-transform":"translateZ(0)","-webkit-perspective":"1000","-webkit-backface-visibility":"hidden"})}s._dragContainer.css({"-webkit-transform":"translateZ(0px)","-webkit-perspective":"1000","-webkit-backface-visibility":"hidden"});s._tPref1="translate3d(";s._tPref2="px, ";s._tPref3="px, 0px)"}else{s._tPref1="translate(";s._tPref2="px, ";s._tPref3="px)"}}else{s.browserSufix=/trident/i.test(navigator.userAgent)?"-ms-":"opera"in window?"-o-":"";s._yProp=s._xProp=s.browserSufix+"transform";s.transitionEndEvent=s.browserSufix+"transitionend.tds";s._tPref1="translate(";s._tPref2="px, ";s._tPref3="px)"}}else{s._xProp="left";s._yProp="top";s._tPref1="";s._tPref2="";s._tPref3="";s._tPref4=""}s._sliderControls=s.sliderRoot.find(".slider-controls");s._albumInfoOpen=false;s._albumInfoAnimRunning=false;s._headerSideMenu=e(".main-header");s._menusContainer=s._headerSideMenu.find(".menus-container");s._menusContainer=s._headerSideMenu.find(".menus-container");s.albumsArr=[];s.currAlbum;s._albumIndicator=s._sliderControls.find(".slider-album-indicator");s._albumInfoText=s._albumIndicator.find(".album-info-text");s._albumNameIndicator=s._albumIndicator.find(".album-name-indicator");s._itemCountIndicator=s._albumIndicator.find(".item-count-indicator");s._albumInfoBlock=e('<div class="album-info-block text-block"><div class="album-info-text"></div></div>').appendTo("body");var S;s._albumIndicator.bind("click",function(){s._toggleAlbumInfo()});if(s.settings.appendGalleriesToMenu){var x=s.sliderRoot.find(".two-dim-album"),T,N='<ul id="gallery-menu" class="menu">',C;x.each(function(t,n){T=e(n).data("start-item",0);C=T.attr("data-album-id");N+='<li data-id="'+C+'" class="menu-item"><a href="#'+C+'">'+T.find(".album-title").text()+"</a></li>";s.albumsArr.push(T)});N+="</ul>"}else{s.sliderRoot.find(".two-dim-album").each(function(t,n){s.albumsArr.push(e(n).data("start-item",0))})}if(!s.albumsArr.length>0){alert("Gallery error :(. No albums and images found");return}var k=0;var L=window.location.hash;if(L){L=L.replace(/^#/,"");k=s.getAlbumIdByIdAtt(L)}s.currAlbum=s.albumsArr[k];s.currAlbumId=k;s.numAlbums=s.albumsArr.length;if(s._arrowControlsEnabled){s._prevImageArr=s.sliderRoot.find(".arrow-left").click(function(e){e.preventDefault();s.prev()});s._nextImageArr=s.sliderRoot.find(".arrow-right").click(function(e){e.preventDefault();s.next()})}s._primaryMenu=s._headerSideMenu.find(".primary-menu > .current-menu-item");if(s.settings.appendGalleriesToMenu&&s.numAlbums>1){if(s._primaryMenu.index()!=0){s._primaryMenu.before('<span class="menu-sep project-menu-sep">&mdash;</span>')}N+='<span class="menu-sep project-menu-sep">&mdash;</span>';s._primaryMenu.append(N);s._galleryMenuItems=s._primaryMenu.find("#gallery-menu").find("li");s._galleryMenuItems.click(function(t){t.preventDefault();t.stopImmediatePropagation();var n=s.getAlbumIdByIdAtt(e(this).attr("data-id"));s._moveTo(n,"y",500,true,true)})}s.currAlbumItems=s.currAlbum.find(".two-dim-item");s.currItemId=0;s.currAlbumNumItems=s.currAlbumItems.length;s.currAlbumScaleMode=s.currAlbum.data("img-scale");var A;e(window).bind(s._orientationChangeEvent,function(){if(A){clearTimeout(A)}A=setTimeout(function(){s.updateSliderSize()},35)});s.updateSliderSize();s.updateContents();s._slidesWrapper.bind(s._downEvent,function(e){s._onDragStart(e)});if(s.settings.keyboardNavEnabled){e(document).keydown(function(e){if(!s._isDragging&&!s._isAnimating){if(e.keyCode===37){e.preventDefault();s.prev()}else if(e.keyCode===39){e.preventDefault();s.next()}else if(e.keyCode===40){e.preventDefault();s.nextAlbum()}else if(e.keyCode===38){e.preventDefault();s.prevAlbum()}else if(e.keyCode===73){s._toggleAlbumInfo()}}})}e("body").bind("mouseleave",function(e){if(s._isDragging){s._onDragRelease(e)}});if(!s.hasTouch){s.sliderRoot.bind("mousewheel",function(e,t,n,r){if(t<0){s.next()}else if(t>0){s.prev()}})}s._changedByHash=false;s._ignoreHashChange=false;s._hashTimeout;s._unblockHashChange();if(s.hasTouch){e.idleTimer(s.hasTouch?4e3:2e3,document,{events:"mousemove touchend mouseup"});e(document).bind("idle.idleTimer",function(){if(!s._albumInfoOpen){s._hideAllControls()}})}else{}if(s.settings.autoOpenDescription){if(s.sliderWidth>900){s._showAlbumInfo();s._fadeOut(s._albumIndicator);s.albumsArr[s.currAlbumId].data("sawInfo",true)}}}t.prototype={getAlbumIdByIdAtt:function(e){var t=this,n=t.albumsArr;for(var r=0;r<n.length;r++){if(n[r].attr("data-album-id")===e){return r}}return 0},_blockHashChange:function(){e(window).unbind("hashchange.tds")},_updateAlbumHash:function(){var e=this;e._updateHash(e.albumsArr[e.currAlbumId].attr("data-album-id"))},_unblockHashChange:function(){var t=this;e(window).bind("hashchange.tds",function(e){var n=location.hash;n=n.replace(/^#/,"");var r=t.getAlbumIdByIdAtt(n);t._moveTo(r,"y",500)})},_updateHash:function(e){var t=this;t._blockHashChange();window.location.hash=e;if(t._hashTimeout){clearTimeout(t._hashTimeout)}t._hashTimeout=setTimeout(function(){t._unblockHashChange()},60)},_doBackAndForthAnim:function(e){function o(){t._isAnimating=false}function u(){t._isAnimating=false;t._animateTo(n,"",r,false,true,o)}var t=this,n,r,i,s=Math.max(t._xDistToSnap,130)/3;t._currAnimSpeed=200;if(e==="bottom"){n=t._tempMainAlbumBlockId*t.sliderHeight;r="y";i=-s}else if(e==="top"){n=t._tempMainAlbumBlockId*t.sliderHeight;r="y";i=s}else if(e==="right"){n=t._tempMainBlockId*t.sliderWidth;r="x";i=-s}else if(e==="left"){n=t._tempMainBlockId*t.sliderWidth;r="x";i=s}if(t._lastItemLink){var a;if(e==="left"||e==="top"){a=t._galleryPostsNavigation.find("a[rel=next]").attr("href")}else{a=t._galleryPostsNavigation.find("a[rel=prev]").attr("href")}if(a){window.location.href=a;return}}t._animateTo(n+i,"",r,false,true,u)},_moveTo:function(e,t,n,r,i,s){var o=this,u,a,f;if(o._isDragging||o._isAnimating){return false}if(o.isVideoPlaying){o.stopAndCloseVideo()}if(t==="y"&&r){o._changeHash=true}else{o._changeHash=false}if(t==="x"){if(e==="next"){if(!o._loopItems&&o.currItemId+1>=o.currAlbumNumItems){o._doBackAndForthAnim("right");return false}o._hideAlbumInfo();o._tempMainBlockId=o._currentMainBlockId-1;o._updateCurrItemId(o.currAlbumId,o.currItemId+1);u=o._rightBlock;o._rightBlock=o._leftBlock;o._leftBlock=o._centerBlock;o._centerBlock=u;a=o._tempMainBlockId*o.sliderWidth;o._currAnimSpeed=n;o._animateTo(a,"next","x",false,i)}else if(e==="prev"){if(!o._loopItems&&o.currItemId-1<0){o._doBackAndForthAnim("left");return false}o._hideAlbumInfo();o._tempMainBlockId=o._currentMainBlockId+1;o._updateCurrItemId(o.currAlbumId,o.currItemId-1);u=o._centerBlock;o._centerBlock=o._leftBlock;o._leftBlock=o._rightBlock;o._rightBlock=u;a=o._tempMainBlockId*o.sliderWidth;o._currAnimSpeed=n;o._animateTo(a,"prev","x",false,i)}else{var l=parseInt(e,10);if(l===o.currItemId+1){o._moveTo("next","x",n)}else if(l===o.currAlbumId-1){o._moveTo("prev","x",n)}else{if(l>o.currItemId){o._tempMainBlockId=o._currentMainBlockId-1;o._updateCurrItemId(o.currAlbumId,currItemId);u=o._rightBlock;o._rightBlock=o._leftBlock;o._leftBlock=o._centerBlock;o._centerBlock=u;a=o._tempMainBlockId*o.sliderWidth;o._currAnimSpeed=n;o._centerBlock.find("img").css("visibility","hidden");o._animateTo(a,"next","x",true,i)}else if(l<o.currItemId){o._tempMainAlbumBlockId=o._currentMainAlbumBlockId+1;o._updateCurrItemId(o.currAlbumId,currItemId);u=o._centerBlock;o._centerBlock=o._leftBlock;o._leftBlock=o._rightBlock;o._rightBlock=u;a=o._tempMainAlbumBlockId*o.sliderHeight;o._currAnimSpeed=n;o._centerBlock.find("img").css("visibility","hidden");o._animateTo(a,"prev","x",true,i)}}}}else{if(e==="next"){if(!o._loopAlbums&&o.currAlbumId+1>=o.numAlbums){if(!s){o._doBackAndForthAnim("bottom")}else{o._doBackAndForthAnim("right")}return false}o._hideAlbumInfo();o._tempMainAlbumBlockId=o._currentMainAlbumBlockId-1;o._updateCurrItemId(o.currAlbumId+1,0);f=o._getAlbum(o.currAlbumId);o.currItemId=f.data("start-item");u=o._bottomBlock;o._bottomBlock=o._topBlock;o._topBlock=o._centerBlock;o._centerBlock=u;a=o._tempMainAlbumBlockId*o.sliderHeight;o._currAnimSpeed=n;o._animateTo(a,"next","y",false,i)}else if(e==="prev"){if(!o._loopAlbums&&o.currAlbumId-1<0){if(!s){o._doBackAndForthAnim("top")}else{o._doBackAndForthAnim("left")}return false}o._hideAlbumInfo();o._tempMainAlbumBlockId=o._currentMainAlbumBlockId+1;o._updateCurrItemId(o.currAlbumId-1,0);f=o._getAlbum(o.currAlbumId);o.currItemId=f.data("start-item");u=o._centerBlock;o._centerBlock=o._topBlock;o._topBlock=o._bottomBlock;o._bottomBlock=u;a=o._tempMainAlbumBlockId*o.sliderHeight;o._currAnimSpeed=n;o._animateTo(a,"prev","y",false,i)}else{var c=parseInt(e,10);if(c===o.currAlbumId+1){o._moveTo("next","y",n,r,i)}else if(c===o.currAlbumId-1){o._moveTo("prev","y",n,r,i)}else{if(c>o.currAlbumId){o._tempMainAlbumBlockId=o._currentMainAlbumBlockId-1;o._updateCurrItemId(c,0);f=o._getAlbum(o.currAlbumId);o.currItemId=f.data("start-item");u=o._bottomBlock;o._bottomBlock=o._topBlock;o._topBlock=o._centerBlock;o._centerBlock=u;a=o._tempMainAlbumBlockId*o.sliderHeight;o._currAnimSpeed=n;o._updateAlbumBackground(o._centerBlock,f.data("bg"),o.currAlbumId);o._centerBlock.find(".play-button-container").remove();o._centerBlock.find("img").css("visibility","hidden");o._animateTo(a,"next","y",true,i)}else if(c<o.currAlbumId){o._tempMainAlbumBlockId=o._currentMainAlbumBlockId+1;o._updateCurrItemId(c,0);f=o._getAlbum(o.currAlbumId);o.currItemId=f.data("start-item");u=o._centerBlock;o._centerBlock=o._topBlock;o._topBlock=o._bottomBlock;o._bottomBlock=u;a=o._tempMainAlbumBlockId*o.sliderHeight;o._currAnimSpeed=n;o._updateAlbumBackground(o._centerBlock,f.data("bg"),o.currAlbumId);o._centerBlock.find(".play-button-container").remove();o._centerBlock.find("img").css("visibility","hidden");o._animateTo(a,"prev","y",true,i)}}}}o._updateControls(t)},next:function(){var e=this;if(!e._nextPrevActionsLocked){e._nextPrevActionsLocked=true;if(e.currItemId+1>=e.currAlbumNumItems&&e.currAlbumId<e.numAlbums-1){e._moveTo("next","y",this.settings.transitionSpeed,true,true)}else{e._moveTo("next","x",this.settings.transitionSpeed,true,true)}e._nextPrevActionsLocked=false}},prev:function(){var e=this;if(!e._nextPrevActionsLocked){e._nextPrevActionsLocked=true;if(!e._loopItems&&e.currItemId-1<0&&e.currAlbumId!=0){e._moveTo("prev","y",this.settings.transitionSpeed,true,true)}else{e._moveTo("prev","x",this.settings.transitionSpeed,true,true)}e._nextPrevActionsLocked=false}},nextItem:function(){this._moveTo("next","x",this.settings.transitionSpeed,true,true)},prevItem:function(){this._moveTo("prev","x",this.settings.transitionSpeed,true,true)},nextAlbum:function(){this._moveTo("next","y",this.settings.transitionSpeed,true,true)},prevAlbum:function(){this._moveTo("prev","y",this.settings.transitionSpeed,true,true)},_updateAlbumBackground:function(e,t,n){if(e.data("bg-album-id")!==n){e.data("bg-album-id",n);e.css("background",t)}},_onDragStart:function(t){var n=this;if(n._isAnimating){t.preventDefault();return false}if(n._isDragging){if(n.hasTouch){n._multipleTouches=true}return}else{if(n.hasTouch){n._multipleTouches=false}}if(n._useCSS3Transitions){n._dragContainer.css(n.browserSufix+"transition-duration","0s")}n._setGrabbingCursor();n._isDragging=true;var r;if(n.hasTouch){var i=t.originalEvent.touches;if(i&&i.length>0){r=i[0];if(i.length>1){n._multipleTouches=true}}else{return false}}else{r=t;t.preventDefault()}e(document).bind(n._moveEvent,function(e){n._onDragMove(e)});e(document).bind(n._upEvent,function(e){n._onDragRelease(e)});n._isVerticalNav=false;n._currMoveAxis="";n.moved=false;n.pointX=n._accelerationX=n.startX=r.pageX;n.pointY=n._accelerationY=n.startY=r.pageY;n.changedX=0;n.changedY=0;n.horDirection=0;n.verDirection=0;n.directionLocked=false;n._startTime=t.timeStamp||(new Date).getTime();n._moveDist=0;if(n.hasTouch){n._slidesWrapper.bind(n._cancelEvent,function(e){n._onDragRelease(e)})}},_onDragMove:function(e){var t=this,n;if(t.hasTouch){var r=e.originalEvent.touches;if(r){if(r.length>1){return false}else{n=r[0]}}else{return false}e.preventDefault()}else{n=e;e.preventDefault()}var i=e.timeStamp||(new Date).getTime(),s=n.pageX-t.pointX,o=n.pageY-t.pointY;t.changedX+=Math.abs(s);t.changedY+=Math.abs(o);if(t.changedY<10&&t.changedX<7){return}var u=t.x+s,a=t.y+o;t.moved=true;t.pointX=n.pageX;t.pointY=n.pageY;var f=t._currMoveAxis;if(f==="x"){if(s!==0){t.horDirection=s>0?1:-1}}else if(f==="y"){if(o!==0){t.verDirection=o>0?1:-1}}else{if(t.changedY>t.changedX){t._isVerticalNav=true;t._currMoveAxis="y";t.verDirection=o>0?1:-1}else{t._currMoveAxis="x";t.horDirection=s>0?1:-1}}if(t._isVerticalNav){if(!t._loopAlbums){if(t.currAlbumId<=0){if(n.pageY-this.startY>0){a=t.y+o*t._lastItemFriction}}if(t.currAlbumId>=t.numAlbums-1){if(n.pageY-this.startY<0){a=t.y+o*t._lastItemFriction}}}t._setPosition(a,"y");if(i-t._startTime>200){t._startTime=i;t._accelerationY=n.pageY}}else{if(!t._loopItems){if(t.currItemId<=0){if(n.pageX-this.startX>0){u=t.x+s*t._lastItemFriction}}if(t.currItemId>=t.currAlbumNumItems-1){if(n.pageX-this.startX<0){u=t.x+s*t._lastItemFriction}}}t._setPosition(u,"x");if(i-t._startTime>200){t._startTime=i;t._accelerationX=n.pageX}}return false},_onDragRelease:function(t){function p(e){if(e<200){return 200}else if(e>500){return 500}return e}function d(e,t,r){if(e==="x"){f=n._currentMainBlockId*n.sliderWidth}else{f=n._currentMainAlbumBlockId*n.sliderHeight}l=Math.abs(n[e]-f);n._currAnimSpeed=l/r;if(t){n._currAnimSpeed+=250}n._currAnimSpeed=p(n._currAnimSpeed);n._animateTo(f,false,e)}var n=this,r=n.hasTouch?t.originalEvent.changedTouches[0]:t,i,s,o,u,a,f,l,c,h;n._isDragging=false;e(document).unbind(n._moveEvent);e(document).unbind(n._upEvent);if(n.hasTouch){n._slidesWrapper.unbind(n._cancelEvent)}n._setGrabCursor();if(!n.moved&&!n._multipleTouches){if(n._albumInfoOpen){n._hideAlbumInfo();return}if(n.hasTouch){if(n._controlsVisible){n._hideAllControls()}else{n._showAllControls()}return}else{if(!e(t.target).hasClass("play-button-icon")){n.next()}return}}u=Math.max(30,t.timeStamp||(new Date).getTime())-n._startTime;var v=0;if(n._isVerticalNav){var m="y",g=r.pageY,y=n.startY,b=n._accelerationY,w=n.currAlbumId,E=n.numAlbums,S=n.verDirection,x=n.sliderHeight,T=n._currentMainAlbumBlockId,N=n._loopAlbums,C=true,k=50}else{var m="x",g=r.pageX,y=n.startX,b=n._accelerationX,w=n.currItemId,E=n.currAlbumNumItems,S=n.horDirection,x=n.sliderWidth,T=n._currentMainBlockId,N=n._loopItems,C=false,k=0}i=g-y;s=Math.abs(i);o=g-b;a=Math.abs(o)/u;if(S===0||E<=1){d(m,true,a);return false}if(!N){if(w<=0){if(S>0){d(m,true,a);return false}}else if(w>=E-1){if(S<0){d(m,true,a);return false}}}if(y+v<g){if(S<0){d(m,false,a);return false}n._moveTo("prev",m,p(Math.abs(n[m]-(T+1)*x)/a),C)}else if(y-v>g){if(S>0){d(m,false,a);return false}n._moveTo("next",m,p(Math.abs(n[m]-(T-1)*x)/a),C)}else{d(m,false,a)}return false},_addItemToLoadQueue:function(e,t,n,r){var i=this,s,o=i._getAlbum(n);if(r==="start-item"){r=o.data("start-item")}s=i._getItem(n,r);if(!s){t.addClass("last-block")}else{if(t.hasClass("last-block")){t.removeClass("last-block")}var u=s.data("img-scale");if(!u){u=o.data("img-scale");s.data("img-scale",u)}e.push({block:t,item:s,bgColor:o.data("bg"),albumId:n})}},_animateTo:function(e,t,n,r,i,s){function a(){var e,i=[],s;if(t){if(n==="x"){o._addItemToLoadQueue(i,o._centerBlock,o.currAlbumId,o.currItemId);o._currentMainBlockId=o._tempMainBlockId;if(t==="next"){o._rightBlock.css("left",-o._currentMainBlockId*100+100+"%");o._addItemToLoadQueue(i,o._rightBlock,o.currAlbumId,o.currItemId+1)}else if(t==="prev"){o._leftBlock.css("left",-o._currentMainBlockId*100-100+"%");o._addItemToLoadQueue(i,o._leftBlock,o.currAlbumId,o.currItemId-1)}o._topBlock.css("left",-o._currentMainBlockId*100+"%");o._bottomBlock.css("left",-o._currentMainBlockId*100+"%");s=o._getAlbum(o.currAlbumId);s.data("start-item",o.currItemId);o._addItemToLoadQueue(i,o._bottomBlock,o.currAlbumId+1,"start-item");o._addItemToLoadQueue(i,o._topBlock,o.currAlbumId-1,"start-item")}else{s=o._getAlbum(o.currAlbumId);o.currItemId=s.data("start-item");o._addItemToLoadQueue(i,o._centerBlock,o.currAlbumId,o.currItemId);o._addItemToLoadQueue(i,o._rightBlock,o.currAlbumId,o.currItemId+1);o._currentMainAlbumBlockId=o._tempMainAlbumBlockId;if(t==="next"){o._bottomBlock.css("top",-o._currentMainAlbumBlockId*100+100+"%");o._addItemToLoadQueue(i,o._bottomBlock,o.currAlbumId+1,"start-item");if(r){o._addItemToLoadQueue(i,o._topBlock,o.currAlbumId-1,"start-item")}}else{o._topBlock.css("top",-o._currentMainAlbumBlockId*100-100+"%");o._addItemToLoadQueue(i,o._topBlock,o.currAlbumId-1,"start-item");if(r){o._addItemToLoadQueue(i,o._bottomBlock,o.currAlbumId+1,"start-item")}}o._leftBlock.css("top",-o._currentMainAlbumBlockId*100+"%");o._rightBlock.css("top",-o._currentMainAlbumBlockId*100+"%");o._addItemToLoadQueue(i,o._leftBlock,o.currAlbumId,o.currItemId-1)}o._updateImageQueue(i)}if(o._changeHash){o._updateAlbumHash()}setTimeout(function(){o._isAnimating=false;o.onTransitionComplete.call(o);if(o._changeHash){o._setGrabCursor()}if(o.settings.autoOpenDescription&&o.sliderWidth>900){if(!o._collapsedSlider){if(o.currItemId===0&&!o.albumsArr[o.currAlbumId].data("sawInfo")){o._showAlbumInfo();o.albumsArr[o.currAlbumId].data("sawInfo",true)}else{o._fadeIn(o._albumIndicator)}}}else{o._fadeIn(o._albumIndicator)}},30)}var o=this,u;o.onTransitionStart.call(o);o._isAnimating=true;o[n]=e;if(n==="x"){u=o._xProp}else{u=o._yProp}var f={};if(isNaN(o._currAnimSpeed)){o._currAnimSpeed=400}if(!o._useCSS3Transitions){f[u]=e;o._dragContainer.animate(f,o._currAnimSpeed,i?o.settings.easeInOutEasing:"easeOutSine")}else{f[o.browserSufix+"transition-duration"]=o._currAnimSpeed+"ms";f[o.browserSufix+"transition-property"]=o.browserSufix+"transform";f[o.browserSufix+"transition-timing-function"]=i!=undefined?o.settings.css3easeInOutEasing:"cubic-bezier(0.390, 0.575, 0.565, 1.000)";o._dragContainer.css(f);o._dragContainer.css(u,o._tPref1+o.x+o._tPref2+o.y+o._tPref3)}if(s){o.loadingTimeout=setTimeout(function(){s.call()},o._currAnimSpeed+50)}else{o.loadingTimeout=setTimeout(function(){a()},o._currAnimSpeed+50)}},_setPosition:function(e,t){var n=this;if(n._useCSS3Transitions){if(t==="y"){n.y=e;n._dragContainer.css(n._yProp,n._tPref1+n.x+n._tPref2+n.y+n._tPref3)}else{n.x=e;n._dragContainer.css(n._xProp,n._tPref1+n.x+n._tPref2+n.y+n._tPref3)}}else{if(t==="y"){n.y=e;n._dragContainer.css(n._yProp,n.y)}else{n.x=e;n._dragContainer.css(n._xProp,n.x)}}},updateSliderSize:function(){var e=this,t=window.innerWidth||document.body.clientWidth,n=window.innerHeight||document.body.clientHeight,r=e._slidesWrapper.width(),i=e._slidesWrapper.height();if(r!=e.sliderWidth||i!=e.sliderHeight){e.sliderWidth=r;e.sliderHeight=i;e._xDistToSnap=1;e._yDistToSnap=1;if(e.sliderWidth<600){e._collapsedSlider=true;e.sliderRoot.addClass("smaller-collapsed-slider")}else{e._collapsedSlider=false;e.sliderRoot.removeClass("smaller-collapsed-slider")}if(t>=850){e._imagePaddingEMs="2";if(!e._controlsVisible){e._showAllControls()}}else if(t<850){if(t>700){e._imagePaddingEMs="1"}else{e._imagePaddingEMs="0"}}if(e._useCSS3Transitions){e._dragContainer.css(e.browserSufix+"transition-duration","0s")}var s=[e._centerBlock,e._leftBlock,e._rightBlock,e._bottomBlock,e._topBlock];var o;var u;for(var a=0;a<s.length;a++){o=s[a].find("img");if(o){e._resizeImage(o,o.data("img-width"),o.data("img-height"))}}e._setPosition(e._currentMainBlockId*e.sliderWidth,"x");e._setPosition(e._currentMainAlbumBlockId*e.sliderHeight,"y");if(e.isVideoPlaying){var f=e.videoContainer.find(".video-player"),l=e._resizeImage("",e.settings.maxVideoWidth,e.settings.maxVideoHeight,true);f.css({"margin-left":l.left,"margin-top":l.top,width:l.width,height:l.height});f.removeAttr("width")}}},updateContents:function(){var e=this,t=e.currAlbumItems.eq(e.currItemId),n=[];e._addItemToLoadQueue(n,e._centerBlock,e.currAlbumId,e.currItemId);e._addItemToLoadQueue(n,e._rightBlock,e.currAlbumId,e.currItemId+1);e._addItemToLoadQueue(n,e._leftBlock,e.currAlbumId,e.currItemId-1);e._addItemToLoadQueue(n,e._bottomBlock,e.currAlbumId+1,0);e._addItemToLoadQueue(n,e._topBlock,e.currAlbumId-1,0);e._updateImageQueue(n);var r=e._getAlbum(e.currAlbumId);r.data("start-item",e.currItemId);e._updateControls()},_getItem:function(e,t){var n=this,r;if(e<0){if(!n._loopAlbums){return false}e=n.numAlbums-1}else if(e>=this.numAlbums){if(!n._loopAlbums){return false}e=0}var i=this.albumsArr[e];if(i){var s=i.find(".two-dim-item");if(s){var o=s.length;if(o<=0){return 0}if(t<0){if(!n._loopItems){return false}t=o-1}else if(t>=o){if(!n._loopItems){return false}t=0}r=s.eq(t)}r.find("img").data("img-scale",i.data("img-scale"))}return r},_updateCurrItemId:function(e,t){var n=this;n._lastAlbumId=n.currAlbumId;n._lastAlbumNumItems=n.currAlbumNumItems;n._lastItemId=n.currItemId;if(e<0){e=n.numAlbums-1}else if(e>=n.numAlbums){e=0}n.currAlbumId=e;var r=n.albumsArr[e];if(r){var i=r.find(".two-dim-item");if(i){var s=i.length;if(s<=0){return 0}n.currAlbumNumItems=s;if(t<0){t=s-1}else if(t>=s){t=0}}n.currItemId=t}else{alert("Album is empty:"+e+" id:"+t)}},_updateControls:function(e){function n(){t._itemCountIndicator.text(""+(t.currItemId+1)+" of "+t.currAlbumNumItems)}var t=this;if(e==="y"){if(t.numAlbums>1){if(t.currAlbumId>=0){if(t.settings.appendGalleriesToMenu){t._galleryMenuItems.removeClass("current-album-menu-item");t._galleryMenuItems.eq(t.currAlbumId).addClass("current-album-menu-item")}if(!t._collapsedSlider){t._fadeOut(t._albumIndicator)}setTimeout(function(){t._itemCountIndicator.text(""+(t.currItemId+1)+" of "+t.currAlbumNumItems);t._albumNameIndicator.text(t.albumsArr[t.currAlbumId].find(".album-title").text())},400);t._updateAlbumIndicator();t._updateItemControls()}}}else if(e==="x"){n();t._updateItemControls()}else{if(t._galleryMenuItems){var r=t._galleryMenuItems.eq(t.currAlbumId);r.addClass("current-album-menu-item")}t._updateAlbumIndicator();t._albumNameIndicator.text(t.albumsArr[t.currAlbumId].find(".album-title").text());n();t._updateItemControls()}},_updateItemControls:function(){var e=this;if(e._arrowControlsEnabled){if(e._prevImageArr.hasClass("disabled-arrow")){e._prevImageArr.removeClass("disabled-arrow")}if(e._nextImageArr.hasClass("disabled-arrow")){e._nextImageArr.removeClass("disabled-arrow")}if(e.currItemId<=0){if(e.currAlbumId>0){if(!e._prevImageArr.hasClass("prev-album-arrow")){e._prevImageArr.addClass("prev-album-arrow").find(".info-text").addClass("info-text-visible")}}else{if(e._lastItemLink&&e._galleryPostsNavigation.find("a[rel=next]").attr("href")){e._prevImageArr.addClass("prev-album-arrow").find(".info-text").addClass("info-text-visible")}else{e._prevImageArr.addClass("disabled-arrow").find(".info-text").removeClass("info-text-visible")}}}else{if(e._prevImageArr.hasClass("prev-album-arrow")){e._prevImageArr.removeClass("prev-album-arrow").find(".info-text").removeClass("info-text-visible")}}if(e.currItemId>=e.currAlbumNumItems-1){if(e.currAlbumId<e.numAlbums-1){if(!e._nextImageArr.hasClass("next-album-arrow")){e._nextImageArr.addClass("next-album-arrow").find(".info-text").addClass("info-text-visible")}}else{if(e._lastItemLink&&e._galleryPostsNavigation.find("a[rel=prev]").attr("href")){e._nextImageArr.addClass("next-album-arrow").find(".info-text").addClass("info-text-visible")}else{e._nextImageArr.addClass("disabled-arrow").find(".info-text").removeClass("info-text-visible")}}}else{if(e._nextImageArr.hasClass("next-album-arrow")){e._nextImageArr.removeClass("next-album-arrow").find(".info-text").removeClass("info-text-visible")}}}},_updateAlbumIndicator:function(){},_getAlbum:function(e){if(e<0){e=this.numAlbums-1}else if(e>=this.numAlbums){e=0}return this.albumsArr[e]},_updateImageQueue:function(e){var t=this;if(e){var n,r,i,s,o,u;for(var a=0;a<e.length;a++){n=e[a];s=n.block;u=n.item.data();if(n.item){r=s.find("img");o=Boolean(u.videoUrl!==undefined);if(!o){s.find(".play-button-container").remove()}i=n.item.find("a").attr("href");if(r.attr("src")!==i){r.css("visibility","hidden")}else{if(!n.block.hasClass("loading")){r.css("visibility","visible")}}t._updateAlbumBackground(s,n.bgColor,n.albumId)}else{e.splice(a,1);a--}}t.isLoading=true}t.loadQueue=e;t._loadNextImage()},_onLoadingComplete:function(e){var t=this;return function(){var n=e.img,r=e.loadDataItem.item.data(),i=e.block.find(".block-inside"),s=Boolean(r.videoUrl!==undefined);if(!n.data("blocked-by-loop")){n.css({visibility:"visible"})}if(s){if(!i.find(".play-button-container").length>0){i.append('<a class="play-button-container"><span class="play-button"><i class="play-icons-wrap"><u class="play-button-icon"></u><u class="play-video-loading-icon"></u></i></snan></a>');i.find(".play-button-container").bind("click",function(n){if(!t.moved){n.preventDefault();n.stopImmediatePropagation();t._controlsVisible=true;t._showVideo(e,i)}else{return false}})}}else{if(i.find(".play-button-container").length>0){i.find("img").css("cursor","inherit").unbind("click");i.find(".play-button-container").unbind("click");i.find(".play-button-container").remove()}}e.block.removeClass("loading");e.block.find(".preloader-container").remove();n.unbind("error.tds");n.unbind("load.tds");if(!t.firstLoaded&&t.settings.firstImageLoadedCallback){t.settings.firstImageLoadedCallback.call(t);t.firstLoaded=true}if(t.loadQueue.length>1){t.loadQueue.shift();t._loadNextImage()}else{t.isLoading=false}}},_loadNextImage:function(){var t=this;var n=t.loadQueue[0];if(!n){return}var r=n.item;if(r){var i=n.block,s=i.find("img").eq(0),o=i.find("#img-desc").eq(0),u=r.find("a").attr("href"),a=r.attr("data-img-width"),f=r.attr("data-img-height"),l=r.attr("data-img-desc");if(s.length<=0){hasImage=false;s=e("<img />");currBlockPath=""}else{hasImage=true;currBlockPath=s.attr("src")}if(o.length<=0){hasDesc=false;o=e('<div id="img-desc" class="img-desc-block text-block"><div class="info-container"><div class="img-content">'+l+"</div></div></div>")}else{hasDesc=true}s.data({"img-width":a,"img-height":f,"img-scale":r.data("img-scale")});if(currBlockPath===u){if(!i.hasClass("loading")){if(t.loadQueue.length>1){t.loadQueue.shift();t._loadNextImage()}else{t.isLoading=false}}return}if(!t.imageLoader||t.imageLoader.attr("src")!=u){i.addClass("loading");i.append('<div class="preloader-container"><div class="preloader-spinner"></div></div>');s.css("visibility","hidden").bind("load.tds",t._onLoadingComplete({type:"loaded",loadDataItem:n,block:i,img:s})).bind("error.tds",t._onLoadingComplete({type:"error",loadDataItem:n,block:i,img:s})).attr({src:u,alt:r.find("a").text()});if(!hasDesc){o.appendTo(i.find(".block-inside"))}if(l.length>0){o.show()}else{o.hide()}if(!hasImage){s.appendTo(i.find(".block-inside"))}t._resizeImage(s,a,f)}else{t._resizeImage(s,a,f);t._onLoadingComplete({type:"loaded",item:r,block:i})}}},_resizeImage:function(e,t,n,r){var i=this;imgScaleMode=!r?e.data("img-scale"):"fit-if-smaller";if(!r){t=parseInt(t,10);n=parseInt(n,10)}if(!r){var s;if(imgScaleMode!=="fill"){s=i._imagePaddingEMs+"em"}else{s="0"}var o=e.parent(".block-inside").css("margin",s);i.imgWrapWidth=o.width();i.imgWrapHeight=o.height()}else{i.imgWrapWidth=i.videoContainer.width();i.imgWrapHeight=i.videoContainer.height()}var u=0,a=i.imgWrapWidth,f=i.imgWrapHeight,l=true,c,h,p,d,v;if(imgScaleMode==="fit-if-smaller"){if(t>a||n>f){imgScaleMode="fit"}}if(imgScaleMode==="fill"||imgScaleMode==="fit"){c=a/t;h=f/n;if(imgScaleMode=="fill"){p=c>h?c:h}else if(imgScaleMode=="fit"){p=c<h?c:h}else{p=1}d=parseInt(t*p,10);v=parseInt(n*p,10)}else{d=t;v=n}if(l){if(e){e.css({"margin-left":Math.floor((a-d)/2),"margin-top":Math.floor((f-v)/2),width:d,height:v})}else{return{width:d,height:v,left:Math.floor((a-d)/2),top:Math.floor((f-v)/2)}}}else{if(e){e.css({width:d,height:v})}else{return{width:d,height:v,left:0,top:0}}}},_setGrabCursor:function(){if(!this.hasTouch){if(this._grabCursor){this._slidesWrapper.css("cursor",this._grabCursor)}else{this._slidesWrapper.removeClass("grabbing-cursor");this._slidesWrapper.addClass("grab-cursor")}}},_setGrabbingCursor:function(){if(!this.hasTouch){if(this._grabbingCursor){this._slidesWrapper.css("cursor",this._grabbingCursor)}else{this._slidesWrapper.removeClass("grab-cursor");this._slidesWrapper.addClass("grabbing-cursor")}}},_showVideo:function(t,n){var r=this;if(r.isVideoPlaying){return false}var i=t.loadDataItem.item.data();if(i.videoUrl!==undefined){var s=i.videoUrl,o;if(s.match(/youtu\.be/i)||s.match(/youtube\.com\/watch/i)){o=r._getYoutubeVideoId(s);if(o){r.isVideoPlaying=true;s="http://www.youtube.com/embed/"+o+"?rel=1";if(r.settings.autoplayVideo){s+="&autoplay=1&showinfo=0"}n.find(".play-button").addClass("play-button-loading");r._fadeInVideo(t.loadDataItem.block);var u=e('<iframe class="video-player" src ="'+s+'" frameborder="no"></iframe>');r.videoOverlay.css("display","block");var a=r._resizeImage("",r.settings.maxVideoWidth,r.settings.maxVideoHeight,true);u.css({"margin-left":a.left,"margin-top":a.top,width:a.width,height:a.height});r._videoCloseButton.removeClass("hidden-video");r.videoContainer.append(u)}else{alert("Incorrect YouTube URL syntax")}}else if(s.match(/vimeo\.com/i)){o=r._getVimeoVideoId(s);r.isVideoPlaying=true;s="http://player.vimeo.com/video/"+o+"?title=0&byline=0&portrait=0";if(r.settings.autoplayVideo)s+="&autoplay=1";n.find(".play-button").addClass("play-button-loading");r._fadeInVideo(t.loadDataItem.block);var u=e('<iframe class="video-player" src ="'+s+'" frameborder="no"></iframe>');r.videoOverlay.css("display","block");var a=r._resizeImage("",r.settings.maxVideoWidth,r.settings.maxVideoHeight,true);u.css({"margin-left":a.left,"margin-top":a.top,width:a.width,height:a.height});r._videoCloseButton.removeClass("hidden-video");r.videoContainer.append(u)}else{alert("Incorrect video URL: "+s)}}},stopAndCloseVideo:function(){var e=this;e._videoCloseButton.addClass("hidden-video");e.videoOverlay.css("display","none");e.videoContainer.find("iframe").remove();var t=e._centerBlock.find("img");if(t.length>0){t.animate({opacity:1},400,"easeOutSine")}e._centerBlock.find(".play-button-loading").removeClass("play-button-loading");e.isVideoPlaying=false;e._showAllControls()},_fadeInVideo:function(e){var t=this;if(t._albumInfoOpen){t._toggleAlbumInfo()}var n=e.find("img");if(n.length>0){n.animate({opacity:0},400,"easeOutSine")}t._hideAllControls()},_showAllControls:function(){var e=this;if(!e._controlsVisible){e._fadeIn(e._headerSideMenu);e._controlsVisible=true;e._fadeIn(e._sliderControls)}},_hideAllControls:function(){var e=this;if(e._controlsVisible){if(e._albumInfoOpen){e._toggleAlbumInfo()}if(e._headerSideMenu.hasClass("collapsed-gallery-page-menu")){e._fadeOut(e._headerSideMenu)}e._fadeOut(e._sliderControls);e._controlsVisible=false}},_fadeOut:function(e,t){setTimeout(function(){e.stop().animate({opacity:0},300,function(){e.css("display","none");if(t){t.call()}})},0)},_fadeIn:function(e,t){e.stop().css("display","block");setTimeout(function(){e.animate({opacity:1},300,function(){if(t){t.call()}})},0)},_getVimeoVideoId:function(e){var t=/\/\/(www\.)?vimeo.com\/(\d+)($|\/)/;var n=e.match(t);if(n){return n[2]}else{return false}},_getYoutubeVideoId:function(e){var t=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;var n=e.match(t);if(n&&n[7].length==11){return n[7]}else{return false}},_showAlbumInfo:function(){var t=this,n;if(!t._albumInfoOpen){if(t._albumInfoBlock.data("curr-album-id")!==t.currAlbumId){var r=t.albumsArr[t.currAlbumId].find(".album-meta");var i='<div class="info-container">'+r.html();var s=r.find(".album-title a");var o=s.attr("href");s=s.html();var u=t._getItem(t.currAlbumId,0).find("a").attr("href");i+='<div class="bottom-bar clearfix">';if(t.settings.showShareButtons){i+='<div class="share-project">';i+='<a href="http://pinterest.com/pin/create/button/?url='+o+"&media="+u+"&description="+s+'" class="pin-it-btn"></a>';i+='<a class="facebook-share-btn" href="http://www.facebook.com/sharer/sharer.php?u='+o+'">';i+="</a>"}i+='<a href="javascript:void(0);" class="close-project">'+t._wpVars.closeProjectInfo+"</a>";i+="</div>";i+="</div>";t._albumInfoBlock.html(i);var a=t._albumInfoBlock.find(".album-title a");a.replaceWith(a.text());var f=t._albumInfoBlock.find(".close-project");f.bind("click",function(e){e.preventDefault();t._hideAlbumInfo()});t._albumInfoBlock.find(".pin-it-btn, .facebook-share-btn").click(function(t){t.preventDefault();var n=window.open(e(this).attr("href"),"signin","width=665,height=300")});if(typeof FB!="undefined"&&FB!=null){FB.XFBML.parse(t._albumInfoBlock.get(0))}t._albumInfoBlock.data("curr-album-id",t.currAlbumId)}t._fadeIn(t._albumInfoBlock);t._fadeOut(t._albumIndicator);t._albumInfoOpen=true}},_hideAlbumInfo:function(){var e=this;if(e._albumInfoOpen){e._albumInfoAnimating=true;e._fadeOut(e._albumInfoBlock,function(){e._albumInfoAnimating=false});e._fadeIn(e._albumIndicator);e._albumInfoOpen=false}},_toggleAlbumInfo:function(){var e=this,t;if(e._albumInfoOpen){e._hideAlbumInfo()}else{e._showAlbumInfo()}},_updateMenuSize:function(){var e=this,t=window.innerWidth||document.body.clientWidth;if(e._isMenuVisible){e._isMenuCollapsed=true;if(t>600){e._headerSideMenu.css("width","50%")}else{e._headerSideMenu.css("width","100%")}}},_getQueryParameters:function(){var e=window.location.href.split("?")[1];if(!e){return{}}var t=e.split("&");var n={};for(var r=0,i=t.length;r<i;r++){var s=t[r].split("=");n[s[0]]=s[1]}return n}};e.fn.twoDimSlider=function(n){return this.each(function(){var r=new t(e(this),n);e(this).data("twoDimSlider",r)})};e.fn.twoDimSlider.defaults={keyboardNavEnabled:true,transitionSpeed:600,autoplayVideo:true,maxVideoWidth:800,maxVideoHeight:600,openInfoBlockAtStart:false,disableContextMenu:false,easeInOutEasing:"easeInOutSine",css3easeInOutEasing:"cubic-bezier(0.445, 0.050, 0.550, 0.950)",firstImageLoadedCallback:false,appendGalleriesToMenu:false,autoOpenDescription:Boolean(tdSliderVars.autoOpenProjectDesc),showShareButtons:Boolean(tdSliderVars.showShareButtons)};e.fn.twoDimSlider.settings={}})(jQuery);(function(e){function r(t){var n=t||window.event,r=[].slice.call(arguments,1),i=0,s=true,o=0,u=0;t=e.event.fix(n);t.type="mousewheel";if(n.wheelDelta){i=n.wheelDelta/120}if(n.detail){i=-n.detail/3}u=i;if(n.axis!==undefined&&n.axis===n.HORIZONTAL_AXIS){u=0;o=-1*i}if(n.wheelDeltaY!==undefined){u=n.wheelDeltaY/120}if(n.wheelDeltaX!==undefined){o=-1*n.wheelDeltaX/120}r.unshift(t,i,o,u);return(e.event.dispatch||e.event.handle).apply(this,r)}var t=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks){for(var n=t.length;n;){e.event.fixHooks[t[--n]]=e.event.mouseHooks}}e.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var e=t.length;e;){this.addEventListener(t[--e],r,false)}}else{this.onmousewheel=r}},teardown:function(){if(this.removeEventListener){for(var e=t.length;e;){this.removeEventListener(t[--e],r,false)}}else{this.onmousewheel=null}}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})})(jQuery);window.Modernizr=function(e,t,n){function r(e){v.cssText=e}function i(e,t){return r(y.join(e+";")+(t||""))}function s(e,t){return typeof e===t}function o(e,t){return!!~(""+e).indexOf(t)}function u(e,t){for(var r in e)if(v[e[r]]!==n)return t=="pfx"?e[r]:!0;return!1}function a(e,t,r){for(var i in e){var o=t[e[i]];if(o!==n)return r===!1?e[i]:s(o,"function")?o.bind(r||t):o}return!1}function f(e,t,n){var r=e.charAt(0).toUpperCase()+e.substr(1),i=(e+" "+w.join(r+" ")+r).split(" ");return s(t,"string")||s(t,"undefined")?u(i,t):(i=(e+" "+E.join(r+" ")+r).split(" "),a(i,t,n))}var l="2.5.2",c={},h=t.documentElement,p="modernizr",d=t.createElement(p),v=d.style,m,g={}.toString,y=" -webkit- -moz- -o- -ms- ".split(" "),b="Webkit Moz O ms",w=b.split(" "),E=b.toLowerCase().split(" "),S={},x={},T={},N=[],C=N.slice,k,L=function(e,n,r,i){var s,o,u,a=t.createElement("div"),f=t.body,l=f?f:t.createElement("body");if(parseInt(r,10))while(r--)u=t.createElement("div"),u.id=i?i[r]:p+(r+1),a.appendChild(u);return s=["&#173;","<style>",e,"</style>"].join(""),a.id=p,l.innerHTML+=s,l.appendChild(a),f||h.appendChild(l),o=n(a,e),f?a.parentNode.removeChild(a):l.parentNode.removeChild(l),!!o},A={}.hasOwnProperty,O;!s(A,"undefined")&&!s(A.call,"undefined")?O=function(e,t){return A.call(e,t)}:O=function(e,t){return t in e&&s(e.constructor.prototype[t],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if(typeof t!="function")throw new TypeError;var n=C.call(arguments,1),r=function(){if(this instanceof r){var i=function(){};i.prototype=t.prototype;var s=new i,o=t.apply(s,n.concat(C.call(arguments)));return Object(o)===o?o:s}return t.apply(e,n.concat(C.call(arguments)))};return r});var M=function(e,n){var r=e.join(""),i=n.length;L(r,function(e,n){var r=t.styleSheets[t.styleSheets.length-1],s=r?r.cssRules&&r.cssRules[0]?r.cssRules[0].cssText:r.cssText||"":"",o=e.childNodes,u={};while(i--)u[o[i].id]=o[i];c.csstransforms3d=(u.csstransforms3d&&u.csstransforms3d.offsetLeft)===9&&u.csstransforms3d.offsetHeight===3},i,n)}([,["@media (",y.join("transform-3d),("),p,")","{#csstransforms3d{left:9px;position:absolute;height:3px;}}"].join("")],[,"csstransforms3d"]);S.csstransforms3d=function(){var e=!!f("perspective");return e&&"webkitPerspective"in h.style&&(e=c.csstransforms3d),e};for(var _ in S)O(S,_)&&(k=_.toLowerCase(),c[k]=S[_](),N.push((c[k]?"":"no-")+k));return r(""),d=m=null,c._version=l,c._prefixes=y,c._domPrefixes=E,c._cssomPrefixes=w,c.testProp=function(e){return u([e])},c.testAllProps=f,c.testStyles=L,c}(this,this.document);(function(e){e.idleTimer=function(t,n,r){r=e.extend({startImmediately:true,idle:false,enabled:true,timeout:3e4,events:"mousemove keydown DOMMouseScroll mousewheel mousedown touchstart touchmove"},r);n=n||document;var i=function(t){if(typeof t==="number"){t=undefined}var s=e.data(t||n,"idleTimerObj");s.idle=!s.idle;var o=+(new Date)-s.olddate;s.olddate=+(new Date);if(s.idle&&o<r.timeout){s.idle=false;clearTimeout(e.idleTimer.tId);if(r.enabled)e.idleTimer.tId=setTimeout(i,r.timeout);return}var u=jQuery.Event(e.data(n,"idleTimer",s.idle?"idle":"active")+".idleTimer");e(n).trigger(u)},s=function(t){var n=e.data(t,"idleTimerObj")||{};n.enabled=false;clearTimeout(n.tId);e(t).off(".idleTimer")},o=function(t){var n=e.data(this,"idleTimerObj");clearTimeout(n.tId);if(n.enabled){if(n.idle){i(this)}n.tId=setTimeout(i,n.timeout)}};var u=e.data(n,"idleTimerObj")||{};u.olddate=u.olddate||+(new Date);if(typeof t==="number"){r.timeout=t}else if(t==="destroy"){s(n);return this}else if(t==="getElapsedTime"){return+(new Date)-u.olddate}e(n).on(e.trim((r.events+" ").split(" ").join(".idleTimer ")),o);u.idle=r.idle;u.enabled=r.enabled;u.timeout=r.timeout;if(r.startImmediately){u.tId=setTimeout(i,u.timeout)}e.data(n,"idleTimer","active");e.data(n,"idleTimerObj",u)};e.fn.idleTimer=function(t,n){if(!n){n={}}if(this[0]){e.idleTimer(t,this[0],n)}return this}})(jQuery)

/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 *
 * Requires: 1.2.2+
 */
(function($){var c=['DOMMouseScroll','mousewheel'];if($.event.fixHooks){for(var i=c.length;i;){$.event.fixHooks[c[--i]]=$.event.mouseHooks}}$.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var i=c.length;i;){this.addEventListener(c[--i],handler,false)}}else{this.onmousewheel=handler}},teardown:function(){if(this.removeEventListener){for(var i=c.length;i;){this.removeEventListener(c[--i],handler,false)}}else{this.onmousewheel=null}}};$.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}});function handler(a){var b=a||window.event,args=[].slice.call(arguments,1),delta=0,returnValue=true,deltaX=0,deltaY=0;a=$.event.fix(b);a.type="mousewheel";if(b.wheelDelta){delta=b.wheelDelta/120}if(b.detail){delta=-b.detail/3}deltaY=delta;if(b.axis!==undefined&&b.axis===b.HORIZONTAL_AXIS){deltaY=0;deltaX=-1*delta}if(b.wheelDeltaY!==undefined){deltaY=b.wheelDeltaY/120}if(b.wheelDeltaX!==undefined){deltaX=-1*b.wheelDeltaX/120}args.unshift(a,delta,deltaX,deltaY);return($.event.dispatch||$.event.handle).apply(this,args)}})(jQuery);



/* Modernizr 2.5.2 (Custom Build) | MIT & BSD
 * Build: http://www.modernizr.com/download/#-csstransforms3d-teststyles-testprop-testallprops-prefixes-domprefixes
 */
;window.Modernizr=function(a,b,c){function y(a){i.cssText=a}function z(a,b){return y(l.join(a+";")+(b||""))}function A(a,b){return typeof a===b}function B(a,b){return!!~(""+a).indexOf(b)}function C(a,b){for(var d in a)if(i[a[d]]!==c)return b=="pfx"?a[d]:!0;return!1}function D(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:A(f,"function")?f.bind(d||b):f}return!1}function E(a,b,c){var d=a.charAt(0).toUpperCase()+a.substr(1),e=(a+" "+n.join(d+" ")+d).split(" ");return A(b,"string")||A(b,"undefined")?C(e,b):(e=(a+" "+o.join(d+" ")+d).split(" "),D(e,b,c))}var d="2.5.2",e={},f=b.documentElement,g="modernizr",h=b.createElement(g),i=h.style,j,k={}.toString,l=" -webkit- -moz- -o- -ms- ".split(" "),m="Webkit Moz O ms",n=m.split(" "),o=m.toLowerCase().split(" "),p={},q={},r={},s=[],t=s.slice,u,v=function(a,c,d,e){var h,i,j,k=b.createElement("div"),l=b.body,m=l?l:b.createElement("body");if(parseInt(d,10))while(d--)j=b.createElement("div"),j.id=e?e[d]:g+(d+1),k.appendChild(j);return h=["&#173;","<style>",a,"</style>"].join(""),k.id=g,m.innerHTML+=h,m.appendChild(k),l||f.appendChild(m),i=c(k,a),l?k.parentNode.removeChild(k):m.parentNode.removeChild(m),!!i},w={}.hasOwnProperty,x;!A(w,"undefined")&&!A(w.call,"undefined")?x=function(a,b){return w.call(a,b)}:x=function(a,b){return b in a&&A(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=t.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(t.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(t.call(arguments)))};return e});var F=function(a,c){var d=a.join(""),f=c.length;v(d,function(a,c){var d=b.styleSheets[b.styleSheets.length-1],g=d?d.cssRules&&d.cssRules[0]?d.cssRules[0].cssText:d.cssText||"":"",h=a.childNodes,i={};while(f--)i[h[f].id]=h[f];e.csstransforms3d=(i.csstransforms3d&&i.csstransforms3d.offsetLeft)===9&&i.csstransforms3d.offsetHeight===3},f,c)}([,["@media (",l.join("transform-3d),("),g,")","{#csstransforms3d{left:9px;position:absolute;height:3px;}}"].join("")],[,"csstransforms3d"]);p.csstransforms3d=function(){var a=!!E("perspective");return a&&"webkitPerspective"in f.style&&(a=e.csstransforms3d),a};for(var G in p)x(p,G)&&(u=G.toLowerCase(),e[u]=p[G](),s.push((e[u]?"":"no-")+u));return y(""),h=j=null,e._version=d,e._prefixes=l,e._domPrefixes=o,e._cssomPrefixes=n,e.testProp=function(a){return C([a])},e.testAllProps=E,e.testStyles=v,e}(this,this.document);


/*!
 * jQuery idleTimer plugin
 * version 0.9.100511
 * by Paul Irish.
 *   http://github.com/paulirish/yui-misc/tree/
 * MIT license
 * Copyright (c) 2009 Nicholas C. Zakas
 * adapted from YUI idle timer by nzakas:
 *   http://github.com/nzakas/yui-misc/
*/
(function(e){e.idleTimer=function(t,n,r){r=e.extend({startImmediately:true,idle:false,enabled:true,timeout:3e4,events:"mousemove keydown DOMMouseScroll mousewheel mousedown touchstart touchmove"},r);n=n||document;var i=function(t){if(typeof t==="number"){t=undefined}var s=e.data(t||n,"idleTimerObj");s.idle=!s.idle;var o=+(new Date)-s.olddate;s.olddate=+(new Date);if(s.idle&&o<r.timeout){s.idle=false;clearTimeout(e.idleTimer.tId);if(r.enabled)e.idleTimer.tId=setTimeout(i,r.timeout);return}var u=jQuery.Event(e.data(n,"idleTimer",s.idle?"idle":"active")+".idleTimer");e(n).trigger(u)},s=function(t){var n=e.data(t,"idleTimerObj")||{};n.enabled=false;clearTimeout(n.tId);e(t).off(".idleTimer")},o=function(t){var n=e.data(this,"idleTimerObj");clearTimeout(n.tId);if(n.enabled){if(n.idle){i(this)}n.tId=setTimeout(i,n.timeout)}};var u=e.data(n,"idleTimerObj")||{};u.olddate=u.olddate||+(new Date);if(typeof t==="number"){r.timeout=t}else if(t==="destroy"){s(n);return this}else if(t==="getElapsedTime"){return+(new Date)-u.olddate}e(n).on(e.trim((r.events+" ").split(" ").join(".idleTimer ")),o);u.idle=r.idle;u.enabled=r.enabled;u.timeout=r.timeout;if(r.startImmediately){u.tId=setTimeout(i,u.timeout)}e.data(n,"idleTimer","active");e.data(n,"idleTimerObj",u)};e.fn.idleTimer=function(t,n){if(!n){n={}}if(this[0]){e.idleTimer(t,this[0],n)}return this}})(jQuery);